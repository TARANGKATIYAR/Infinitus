{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Padlet Wall of Dreams</title>
    <link
      rel="icon"
      type="image/x-icon"
      href="{% static './media/logo.png' %}"
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&family=Orbitron:wght@600&family=Poppins:wght@300;400;600&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="{% static './css/aos.css' %}" />

    <link rel="stylesheet" href="{% static './css/padlet.css' %}" />

    <script>
      document.cookie = "csrftoken={{ csrf_token }}";
    </script>
  </head>
  <body>
    <br /><br />
    <header class="header-section" data-aos="fade-down">
      <h1 class="title">Padlet Wall of Dreams</h1>
      <p class="subtitle">
        Where imagination meets collaboration â€” powered by AI.
      </p>
    </header>
    <button id="openModalBtn" class="floating-add-btn" title="Add your dream">
      +
    </button>

    <div id="modalOverlay" class="modal-overlay">
      <div class="modal">
        <button id="closeModalBtn" aria-label="Close modal" class="close-btn">
          &times;
        </button>
        <h2>Add Your Dream</h2>
        {% csrf_token %}
        <form id="postForm" method="POST" action="/submit">
          <input
            type="text"
            id="titleInput"
            name="title"
            placeholder="Dream Title"
            required
          />
          <input
            type="text"
            id="nameInput"
            name="name"
            placeholder="Your Name"
            required
          />
          <textarea
            id="descriptionInput"
            name="description"
            placeholder="Describe your dream..."
            rows="4"
            required
          ></textarea>
          <div class="form-actions">
            <button type="submit" class="submit-btn">Post</button>
          </div>
        </form>
      </div>
    </div>

    <section class="post-wall" data-aos="fade-up">
      <div id="postGrid" class="post-grid">
        {% for dream in dreams %}
        <div class="post-card" data-aos="zoom-in" data-aos-delay="100">
          <h3>{{ dream.title }}</h3>
          <p>{{ dream.description }}</p>
          <p class="author">- {{ dream.name }}</p>
        </div>
        {% empty %}
        <p>No dreams posted yet. Be the first!</p>
        {% endfor %}
      </div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
    <script>
      AOS.init();
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("postForm");

        form.addEventListener("submit", function (e) {
          e.preventDefault();

          const title = document.getElementById("titleInput").value;
          const name = document.getElementById("nameInput").value;
          const description = document.getElementById("descriptionInput").value;

          fetch("/submit", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "X-CSRFToken": getCookie("csrftoken"),
            },
            body: JSON.stringify({ title, name, description }),
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.status === "success") {
                location.reload();
              } else {
                alert("Submission failed!");
              }
            })
            .catch((error) => {
              console.error("Error:", error);
            });
        });

        function getCookie(name) {
          let cookieValue = null;
          if (document.cookie && document.cookie !== "") {
            const cookies = document.cookie.split(";");
            for (let cookie of cookies) {
              cookie = cookie.trim();
              if (cookie.startsWith(name + "=")) {
                cookieValue = decodeURIComponent(cookie.slice(name.length + 1));
                break;
              }
            }
          }
          return cookieValue;
        }

        document.getElementById("openModalBtn").onclick = () => {
          document.getElementById("modalOverlay").style.display = "flex";
        };
        document.getElementById("closeModalBtn").onclick = () => {
          document.getElementById("modalOverlay").style.display = "none";
        };
      });
    </script>
  </body>
</html>
